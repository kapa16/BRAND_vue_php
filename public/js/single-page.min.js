class ReviewsControl{constructor(e,t=5,i="#reviews-container",s="#singlePage-form"){this.source=e,this.container=i,this.form=s,this.reviews=[],this.countReviewOnPage=t,this.pagination=Object,this._init()}_init(){this._renderForm(),fetch(this.source).then(e=>e.json()).then(e=>{for(const t of e)this.reviews.push(t);this.countReviewOnPage&&(this.pagination=new Pagination(this._getCountReviewParts(),this.container),$(this.container).on("click",this.pagination.paginationItemSelector,e=>{this.pagination.changePagination(e),this._renderReviews()})),this._renderReviews()})}_getCountReviewParts(){return Math.ceil(this.reviews.length/this.countReviewOnPage)}_renderForm(){const e=$('<label class="form-elements" for="userName">Введите имя</label>'),t=$('<input class="form-elements" type="text" name="userName" id="userName">');e.append(t);const i=$("<textarea/>",{id:"reviewText",class:"form-elements",name:"singlePage",cols:"30",rows:"10",placeholder:"Напишите отзыв"}),s=$('<button class="form-elements" type="submit">Отправить</button>');$(this.form).append(e).append(i).append(s).submit(e=>this._onFormSubmit(e))}_renderReviews(){$(this.container).text("");let e=[];if(this.countReviewOnPage){const t=this.pagination.currentPart*this.countReviewOnPage;let i=t+this.countReviewOnPage;e=this.reviews.slice(t,i)}else e=this.reviews.slice(0);e.forEach(e=>this._renderReview(e)),this._getCountReviewParts()&&(this.pagination.countParts=this._getCountReviewParts(),this.pagination.render())}_renderReview(e){const t=$(`<div class="review" data-id="${e.id}"></div>`),i=this._getReviewRatingElement(),s=$(`<p class="review__user  brand-style">${e.author}</p>`),n=$(`<p class="review__text">${e.text}</p>`),a=$('<div class="review__content"></div>');a.append(s).append(n);const r=$('<div class="review__control"></div>'),o=$(`<div class="fas fa-times-circle delete-product" data-id="${e.id}"></div>`);if(o.click(e=>this._onDeleteClick(e)),r.append(o),e.approved)t.addClass("approved");else{const t=$(`<div class="button-black review__btn" data-id="${e.id}">Approve</div>`);t.click(e=>this._onApproveClick(e)),r.append(t)}t.append(i).append(a).append(r).prependTo($(this.container))}_getReviewRatingElement(){const e=$('<div class="review__rating"></div>');for(let t=0;t<5;t++)e.append('<i class="fas fa-star rating-star"></i>');return e}_getReviewWrap(e){return $(e).closest(".singlePage")}_findReview(e){for(const t of this.reviews)if(t.id===+e)return t}_onApproveClick(e){this._getReviewWrap(e.target).addClass("approved");const t=e.target.dataset.id;this._findReview(t).approved=!0,$(e.target).remove()}_onDeleteClick(e){const t=this._findReview(e.target.dataset.id);this.reviews.splice(this.reviews.indexOf(t),1),this._renderReviews()}_getLastReviewId(){const e=this.reviews.map(e=>e.id);return Math.max(...e)+1}_addReview(){const e={id:this._getLastReviewId(),author:$("#userName").val(),text:$("#reviewText").val()};this.reviews.push(e),this._renderReviews()}_onFormSubmit(e){e.preventDefault(),this.validateForm()||alert("Необходимо заполнить форму"),this._addReview(),$("#userName").val(""),$("#reviewText").val("")}validateForm(){return this._checkField("#userName")&&this._checkField("#reviewText")}_checkField(e){return 0!==$(e).val().length}}class Carousel{constructor(e=".carousel"){this.containerSelector=e,this._init()}_init(){this._addHandlers()}_addHandlers(){$(this.containerSelector).on("click",".carousel__control",e=>this._onControlClick(e))}_onControlClick(e){let t=1;$(e.target).closest(".carousel__control").hasClass("carousel__prev")&&(t=-1),this._changeSlide(t)}_changeSlide(e){const t=$(".carousel__block:visible"),i=$(".carousel__block"),s=t.index(),n=i.length-1,a=this._getNextElementIndex(e,s,n);t.hide(),i.eq(a).show()}_getNextElementIndex(e,t,i){let s=t+e;return s<0?s=i:s>i&&(s=0),s}}class SelectColor{constructor(e,t="#color"){this.colorItems=e,this.containerId=t,this.currenColor={name:"no color",color:"rgba(0,0,0,0)"},this.$listWrap=$("<ul/>"),this._init()}_init(){this.colorItems.length&&(this.currenColor=this.colorItems[0],this._createList(),$(this.containerId).click(()=>this.$listWrap.toggle()),$(this.containerId).on("click",".select__item",e=>this._onChooseItem(e))),this._createMainElement(),this._setChosenItem()}_createMainElement(){$(this.containerId).append($('<span class="color-example color-select"></span>')).append('<span class="color-name"></span>').append('<i class="fas fa-angle-down icon-drop-list"></i>')}_createList(){this.$listWrap=$('<ul class="select__items">'),this.colorItems.forEach(e=>{const t=$('<span class="color-example"></span>').css("background",e.color);this.$listWrap.append($(`<li class="select__item">${e.name}</li>`).append(t))}),this.$listWrap.hide().appendTo($(this.containerId))}_setChosenItem(){$(this.containerId).find(".color-select").css("background",this.currenColor.color),$(this.containerId).find(".color-name").text(this.currenColor.name)}_onChooseItem(e){const t=$(e.target).text();this.currenColor=this.colorItems.find(e=>e.name===t),this._setChosenItem()}}class Pagination{constructor(e,t){this.countParts=e,this.container=t,this.currentPart=0,this.paginationItemSelector=".pagination-link"}render(){const e=$('<div class="pagination-wrap"></div>'),t=$('<div class="pagination"></div>');t.append('<a href="#" class="pagination-link pagination-link-prev"></a>');for(let e=0;e<this.countParts;e++){const i=$(`<a href="#" class="pagination-link">${e+1}</a>`);this.currentPart===e&&i.addClass("pagination-link-active"),t.append(i)}t.append('<a href="#" class="pagination-link pagination-link-next"></a>').appendTo(e.appendTo($(this.container)))}changePagination(e){e.preventDefault(),$(e.target).hasClass("pagination-link-prev")?--this.currentPart<0&&(this.currentPart=0):$(e.target).hasClass("pagination-link-next")?++this.currentPart>this.countParts-1&&(this.currentPart=this.countParts-1):this.currentPart=+$(e.target).text()-1}}$(document).ready(()=>{new ReviewsControl("json/reviews.json"),new Carousel,new SelectColor([{name:"red",color:"red"},{name:"blue",color:"blue"},{name:"green",color:"#98FB98"}])});