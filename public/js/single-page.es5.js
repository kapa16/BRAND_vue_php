"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ReviewsControl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#reviews-container",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#singlePage-form";_classCallCheck(this,e),this.source=t,this.container=i,this.form=a,this.reviews=[],this.countReviewOnPage=n,this.pagination=Object,this._init()}return _createClass(e,[{key:"_init",value:function(){var e=this;this._renderForm(),fetch(this.source).then(function(e){return e.json()}).then(function(t){var n=!0,i=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;e.reviews.push(s)}}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}e.countReviewOnPage&&(e.pagination=new Pagination(e._getCountReviewParts(),e.container),$(e.container).on("click",e.pagination.paginationItemSelector,function(t){e.pagination.changePagination(t),e._renderReviews()})),e._renderReviews()})}},{key:"_getCountReviewParts",value:function(){return Math.ceil(this.reviews.length/this.countReviewOnPage)}},{key:"_renderForm",value:function(){var e=this,t=$('<label class="form-elements" for="userName">Введите имя</label>'),n=$('<input class="form-elements" type="text" name="userName" id="userName">');t.append(n);var i=$("<textarea/>",{id:"reviewText",class:"form-elements",name:"singlePage",cols:"30",rows:"10",placeholder:"Напишите отзыв"}),a=$('<button class="form-elements" type="submit">Отправить</button>');$(this.form).append(t).append(i).append(a).submit(function(t){return e._onFormSubmit(t)})}},{key:"_renderReviews",value:function(){var e=this;$(this.container).text("");var t=[];if(this.countReviewOnPage){var n=this.pagination.currentPart*this.countReviewOnPage,i=n+this.countReviewOnPage;t=this.reviews.slice(n,i)}else t=this.reviews.slice(0);t.forEach(function(t){return e._renderReview(t)}),this._getCountReviewParts()&&(this.pagination.countParts=this._getCountReviewParts(),this.pagination.render())}},{key:"_renderReview",value:function(e){var t=this,n=$('<div class="review" data-id="'.concat(e.id,'"></div>')),i=this._getReviewRatingElement(),a=$('<p class="review__user  brand-style">'.concat(e.author,"</p>")),r=$('<p class="review__text">'.concat(e.text,"</p>")),o=$('<div class="review__content"></div>');o.append(a).append(r);var s=$('<div class="review__control"></div>'),l=$('<div class="fas fa-times-circle delete-product" data-id="'.concat(e.id,'"></div>'));if(l.click(function(e){return t._onDeleteClick(e)}),s.append(l),e.approved)n.addClass("approved");else{var c=$('<div class="button-black review__btn" data-id="'.concat(e.id,'">Approve</div>'));c.click(function(e){return t._onApproveClick(e)}),s.append(c)}n.append(i).append(o).append(s).prependTo($(this.container))}},{key:"_getReviewRatingElement",value:function(){for(var e=$('<div class="review__rating"></div>'),t=0;t<5;t++)e.append('<i class="fas fa-star rating-star"></i>');return e}},{key:"_getReviewWrap",value:function(e){return $(e).closest(".singlePage")}},{key:"_findReview",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,r=this.reviews[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;if(o.id===+e)return o}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"_onApproveClick",value:function(e){this._getReviewWrap(e.target).addClass("approved");var t=e.target.dataset.id;this._findReview(t).approved=!0,$(e.target).remove()}},{key:"_onDeleteClick",value:function(e){var t=this._findReview(e.target.dataset.id);this.reviews.splice(this.reviews.indexOf(t),1),this._renderReviews()}},{key:"_getLastReviewId",value:function(){var e=this.reviews.map(function(e){return e.id});return Math.max.apply(Math,_toConsumableArray(e))+1}},{key:"_addReview",value:function(){var e={id:this._getLastReviewId(),author:$("#userName").val(),text:$("#reviewText").val()};this.reviews.push(e),this._renderReviews()}},{key:"_onFormSubmit",value:function(e){e.preventDefault(),this.validateForm()||alert("Необходимо заполнить форму"),this._addReview(),$("#userName").val(""),$("#reviewText").val("")}},{key:"validateForm",value:function(){return this._checkField("#userName")&&this._checkField("#reviewText")}},{key:"_checkField",value:function(e){return 0!==$(e).val().length}}]),e}(),Carousel=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".carousel";_classCallCheck(this,e),this.containerSelector=t,this._init()}return _createClass(e,[{key:"_init",value:function(){this._addHandlers()}},{key:"_addHandlers",value:function(){var e=this;$(this.containerSelector).on("click",".carousel__control",function(t){return e._onControlClick(t)})}},{key:"_onControlClick",value:function(e){var t=1;$(e.target).closest(".carousel__control").hasClass("carousel__prev")&&(t=-1),this._changeSlide(t)}},{key:"_changeSlide",value:function(e){var t=$(".carousel__block:visible"),n=$(".carousel__block"),i=t.index(),a=n.length-1,r=this._getNextElementIndex(e,i,a);t.hide(),n.eq(r).show()}},{key:"_getNextElementIndex",value:function(e,t,n){var i=t+e;return i<0?i=n:i>n&&(i=0),i}}]),e}(),SelectColor=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#color";_classCallCheck(this,e),this.colorItems=t,this.containerId=n,this.currenColor={name:"no color",color:"rgba(0,0,0,0)"},this.$listWrap=$("<ul/>"),this._init()}return _createClass(e,[{key:"_init",value:function(){var e=this;this.colorItems.length&&(this.currenColor=this.colorItems[0],this._createList(),$(this.containerId).click(function(){return e.$listWrap.toggle()}),$(this.containerId).on("click",".select__item",function(t){return e._onChooseItem(t)})),this._createMainElement(),this._setChosenItem()}},{key:"_createMainElement",value:function(){$(this.containerId).append($('<span class="color-example color-select"></span>')).append('<span class="color-name"></span>').append('<i class="fas fa-angle-down icon-drop-list"></i>')}},{key:"_createList",value:function(){var e=this;this.$listWrap=$('<ul class="select__items">'),this.colorItems.forEach(function(t){var n=$('<span class="color-example"></span>').css("background",t.color);e.$listWrap.append($('<li class="select__item">'.concat(t.name,"</li>")).append(n))}),this.$listWrap.hide().appendTo($(this.containerId))}},{key:"_setChosenItem",value:function(){$(this.containerId).find(".color-select").css("background",this.currenColor.color),$(this.containerId).find(".color-name").text(this.currenColor.name)}},{key:"_onChooseItem",value:function(e){var t=$(e.target).text();this.currenColor=this.colorItems.find(function(e){return e.name===t}),this._setChosenItem()}}]),e}(),Pagination=function(){function e(t,n){_classCallCheck(this,e),this.countParts=t,this.container=n,this.currentPart=0,this.paginationItemSelector=".pagination-link"}return _createClass(e,[{key:"render",value:function(){var e=$('<div class="pagination-wrap"></div>'),t=$('<div class="pagination"></div>');t.append('<a href="#" class="pagination-link pagination-link-prev"></a>');for(var n=0;n<this.countParts;n++){var i=$('<a href="#" class="pagination-link">'.concat(n+1,"</a>"));this.currentPart===n&&i.addClass("pagination-link-active"),t.append(i)}t.append('<a href="#" class="pagination-link pagination-link-next"></a>').appendTo(e.appendTo($(this.container)))}},{key:"changePagination",value:function(e){e.preventDefault(),$(e.target).hasClass("pagination-link-prev")?--this.currentPart<0&&(this.currentPart=0):$(e.target).hasClass("pagination-link-next")?++this.currentPart>this.countParts-1&&(this.currentPart=this.countParts-1):this.currentPart=+$(e.target).text()-1}}]),e}();$(document).ready(function(){new ReviewsControl("json/reviews.json"),new Carousel,new SelectColor([{name:"red",color:"red"},{name:"blue",color:"blue"},{name:"green",color:"#98FB98"}])});
//# sourceMappingURL=single-page.es5.js.map
